<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/layout :: head}"></head>
<body>

    <header th:replace="~{layout/layout :: navbar}"></header>

    <div class="container mt-4">
        
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h2><i class="fa-solid fa-boxes-stacked"></i> Gestión de Inventario</h2>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-primary" onclick="abrirModal('/web/materiales/nuevo', 'Nuevo Material')">
                    <i class="fa-solid fa-plus"></i> Nuevo Material
                </button>
            </div>
        </div>

        <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${mensaje}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="text-end mb-3">
            <a th:href="@{/web/reportes/residuos}" class="btn btn-danger btn-lg">
                <i class="fa-solid fa-file-pdf"></i> Descargar lista
            </a>
        </div>

        <div class="card shadow-sm mb-5 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-recycle"></i> Residuos de materia prima</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Categoría</th>
                            <th class="text-end">Stock Actual</th>
                            <th class="text-end">Precio Compra</th> 
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="m : ${residuos}" th:if="${m.tipo == 'RESIDUO'}">
                            <td th:text="${m.id}">1</td>
                            <td th:text="${m.nombre}" class="fw-bold">Botella PET</td>
                            <td th:text="${m.categoria.nombre}">Plásticos</td>
                            <td class="text-end">
                                <span th:text="${m.stock}" class="fw-bold">120.5</span> 
                                <small class="text-muted" th:text="${m.unidad}">KG</small>
                            </td>
                            <td class="text-end text-danger">
                                - S/ <span th:text="${m.precioCompra}">0.50</span>
                            </td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-warning btn-sm" 
                                            th:onclick="'abrirModal(\'/web/materiales/editar/' + ${m.id} + '\', \'Editar Residuo\')'">
                                        <i class="fa-solid fa-pen"></i>
                                    </button>
                                    <a th:href="@{/web/materiales/eliminar/{id}(id=${m.id})}" class="btn btn-danger btn-sm" onclick="return confirm('¿Eliminar residuo?')">
                                        <i class="fa-solid fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(residuos)}"> 
                            <td colspan="6" class="text-center">No hay datos</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-end mb-3">
            <a th:href="@{/web/reportes/productos}" class="btn btn-danger btn-lg">
                <i class="fa-solid fa-file-pdf"></i> Descargar lista
            </a>
        </div>

        <div class="card shadow-sm border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fa-solid fa-box-open"></i> Productos Terminados</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Categoría</th>
                            <th class="text-end">Stock Actual</th>
                            <th class="text-end">Precio Venta</th> 
                            <th class="text-center">Factor Conv.</th> 
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="m : ${productos}" th:if="${m.tipo == 'PRODUCTO'}">
                            <td th:text="${m.id}">5</td>
                            <td th:text="${m.nombre}" class="fw-bold">Bloque PET</td>
                            <td th:text="${m.categoria.nombre}">Compactados</td>
                            <td class="text-end">
                                <span th:text="${m.stock}" class="fw-bold">50</span> 
                                <small class="text-muted" th:text="${m.unidad}">UND</small>
                            </td>
                            <td class="text-end text-success">
                                + S/ <span th:text="${m.precioVenta}">15.00</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-info text-dark">
                                    x<span th:text="${m.factorConversion}">10.0</span>
                                </span>
                            </td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-warning btn-sm" 
                                            th:onclick="'abrirModal(\'/web/materiales/editar/' + ${m.id} + '\', \'Editar Producto\')'">
                                        <i class="fa-solid fa-pen"></i>
                                    </button>
                                    <a th:href="@{/web/materiales/eliminar/{id}(id=${m.id})}" class="btn btn-danger btn-sm" onclick="return confirm('¿Eliminar producto?')">
                                        <i class="fa-solid fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(productos)}"> 
                            <td colspan="7" class="text-center">No hay datos</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <br><br> 
    </div>

    <div class="modal fade" id="modalGenerico" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-white" style="background-color: #6f42c1;">
                    <h5 class="modal-title" id="tituloModal">Título</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="contenedorFormulario"></div>
            </div>
        </div>
    </div>

    <footer th:replace="~{layout/layout :: footer}"></footer>

    <script>
        function abrirModal(url, titulo) {
            $('#tituloModal').text(titulo);
            $.get(url, function(data) {
                $('#contenedorFormulario').html(data);
                var myModal = new bootstrap.Modal(document.getElementById('modalGenerico'));
                myModal.show();
            });
        }
    </script>

</body>
</html>